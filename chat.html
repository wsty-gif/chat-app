<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Chat - LINE風</title>
<style>
  /* 全体リセット */
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: "Helvetica Neue", "Arial", sans-serif;
    background-color: #e5ddd5; /* LINEトーク背景色 */
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  /* ヘッダー */
  header {
    background-color: #075e54; /* LINE上部バー風 */
    color: #fff;
    padding: 16px;
    font-size: 22px;
    text-align: center;
    font-weight: bold;
  }

  #chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 12px;
    overflow-y: auto;
  }

  .row {
    display: flex;
    margin-bottom: 10px;
  }

  .row.user {
    justify-content: flex-end;
  }

  .row.assistant {
    justify-content: flex-start;
  }

  .bubble {
    max-width: 75%;
    padding: 14px 18px;
    border-radius: 20px;
    line-height: 1.5;
    word-wrap: break-word;
    font-size: 17px;
  }

  .row.user .bubble {
    background-color: #dcf8c6; /* LINE緑 */
    border-bottom-right-radius: 4px;
  }

  .row.assistant .bubble {
    background-color: #ffffff; /* 白 */
    border-bottom-left-radius: 4px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.15);
  }

  /* フッター（入力欄） */
  #input-area {
    display: flex;
    padding: 12px;
    background-color: #f0f0f0;
    border-top: 1px solid #ccc;
  }

  #input {
    flex: 1;
    border: 1px solid #ccc;
    border-radius: 25px;
    padding: 14px 16px;
    font-size: 18px;
    resize: none;
    max-height: 220px;
    overflow-y: auto;
  }

  #send {
    margin-left: 10px;
    background-color: #075e54;
    color: #fff;
    border: none;
    border-radius: 25px;
    padding: 0 22px;
    font-size: 18px;
    cursor: pointer;
  }

  #send:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* スマホ幅調整 */
  @media (max-width: 600px) {
    .bubble {
      max-width: 85%;
      font-size: 16px;
      padding: 12px 16px;
    }
    #input {
      font-size: 16px;
      padding: 12px 14px;
    }
    #send {
      font-size: 16px;
      padding: 0 18px;
    }
  }
</style>
</head>
<body>

<header>AIチャット</header>

<div id="chat-container"></div>

<div id="input-area">
  <textarea id="input" rows="1" placeholder="メッセージを入力"></textarea>
  <button id="send">送信</button>
</div>

<script>
const elMessages = document.getElementById('chat-container');
const elInput = document.getElementById('input');
const elSend = document.getElementById('send');

const history = [];

function addBubble(role, text) {
  const row = document.createElement('div');
  row.className = `row ${role}`;
  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.textContent = text;
  row.appendChild(bubble);
  elMessages.appendChild(row);
  elMessages.scrollTop = elMessages.scrollHeight;
}

async function sendMessage() {
  const text = (elInput.value || '').trim();
  if (!text) return;
  elInput.value = '';
  elInput.style.height = 'auto';
  addBubble('user', text);
  history.push({ role: 'user', content: text });
  elSend.disabled = true;
  addBubble('assistant', '…');
  const thinkingEl = elMessages.lastElementChild.querySelector('.bubble');

  try {
    const res = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateText?key=AIzaSyAGJBEf57Wb3L_PemkLC7kk0YsD5oKGK3c",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          prompt: text,
          temperature: 0.7,
          maxOutputTokens: 512
        })
      }
    );

    const data = await res.json();
    const reply = data.candidates?.[0]?.output || '(返答が空でした)';
    thinkingEl.textContent = reply;
    history.push({ role: 'assistant', content: reply });
  } catch (e) {
    thinkingEl.textContent = 'エラーが発生しました。時間をおいて再試行してください。';
    console.error(e);
  } finally {
    elSend.disabled = false;
    elInput.focus();
  }
}

// 送信ボタン
elSend.addEventListener('click', sendMessage);

// Enter送信 / Shift+Enter改行
elInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

// 入力のオートリサイズ
elInput.addEventListener('input', () => {
  elInput.style.height = 'auto';
  elInput.style.height = Math.min(elInput.scrollHeight, 220) + 'px';
});

// 初期メッセージ
addBubble('assistant', 'こんにちは！ご用件を教えてください。');
</script>

</body>
</html>
